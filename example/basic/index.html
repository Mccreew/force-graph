<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <style> body {
    margin: 0;
  } </style>

  <!--<script src="//unpkg.com/force-graph"></script>-->
  <script src="../../dist/force-graph.js"></script>
  <script src="drawControlCircle.js"></script>
</head>

<body>
<div id="graph"></div>

<script>
	let data;
	const Graph = ForceGraph()
	(document.getElementById('graph'))
	// .linkDirectionalParticles(2))
		.onNodeClick((n, od) => {

			// console.log('node.position: ', n.x, n.y)
			Graph.centerAt(n.x, n.y, 1000);

			// console.log('Graph.centerAt: ', Graph.centerAt(), 'Graph.zoom: ', Graph.zoom())


			if (n.expand) {
				return
			}
			n.expand = true
			// Graph.zoom(8, 2000);

			axios.get('http://localhost:8080/start/' + n.id).then(req => {
				od.nodes.push(...req.data.nodes)
				od.links.push(...req.data.links)

				// console.log('od: ', od)

				Graph.graphData(od)
			})
		})
		.onEngineStop(() => {
			console.log('animation end')
		})
		.onLinkClick(l => {
			console.log(l)
		})
		.linkDirectionalArrowLength(4)
	// .nodeAutoColorBy('group')
	// .linkAutoColorBy('group');

	axios.get('http://localhost:8080/data/1').then(req => {
		data = req.data
		let insideData = new Object()
		insideData = Object.assign(insideData, data)

		let firstLayerNodes = [];
		insideData.nodes = insideData.nodes.filter(n => {
			if (n.properties.layer === 0 ? n : null) {
				firstLayerNodes.push(n)
			}
			return n.properties.layer === 0;
		})

		insideData.links = []


		Graph.originData(insideData)
		Graph.graphData(insideData)
	})
</script>
</body>
